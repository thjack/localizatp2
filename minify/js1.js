/*********************************************
 * Copyright (c) 2015-2016 Jose Venegas
 * 
 * Si desea soporte contacte a:
 * jvenegasperu@gmail.com Facebook & Skype: jvenegasperu
 *********************************************/
function onBodyLoad(){document.addEventListener("deviceready",onDeviceReady,false);};function onDeviceReady(){}
function u1(){navigator.geolocation.getCurrentPosition(onSuccess,onError,{enableHighAccuracy: true,maximumAge: 60000});};var watchID=null;var Lat1;var Long2;var Precision;var Lat3;var Long4;var P1;var ListView;function actualizarmiubicacion(){watchID=navigator.geolocation.watchPosition(coordenadasbien,coordenadasmal,{maximumAge: 60000,timeout: 5000,enableHighAccuracy: true});};var conta=0;function coordenadasbien(position){precision=position.coords.accuracy;if(conta==0){precisionbuena=precision;conta=1;};if(precision<precisionbuena){precisionbuena=precision;Lat1=position.coords.latitude;Long2=position.coords.longitude;}};function coordenadasmal(position){};function onSuccess(position){Lat1=position.coords.latitude;Long2=position.coords.longitude;Precision=position.coords.accuracy;};function onError(){};function BusSum(){u1();var intevalo=setInterval('actualizarmiubicacion()',10000);if(typeof(Lat1)==="undefined"||typeof(Long2)==="undefined"){alert("Dame unos segundos aun te estoy ubicando");}else{if(Precision>50){alert('Ubicado con una precisi√≥n de '+Precision+' por favor espera unos segundos mas para mejorar la precision');}else{var $ul=$("#list_view");$ul.empty();$.getJSON('200.60.11.227:81/moviles3/busSum.php?lat1='+Lat1+'&long2='+Long2,function(result){var data=result.results;var listaAGuardar=JSON.stringify(data);localStorage.setItem("lista",listaAGuardar);for(var item in data){var id=data[item].id;var nomcli=data[item].nomcli;var nomcli1=data[item].nomcli;var nomcli=escape(data[item].nomcli);var lat=data[item].st_x;var long=data[item].st_y;var vgral=data[item].vgral;var vgral=escape(data[item].vgral);content='<li><a onclick="funca('+lat+','+long+','+Lat1+','+Long2+',\''+id+'\',\''+nomcli+'\',\''+vgral+'\');">'+id+'-'+nomcli1+'</a></li>';$ul.append(content);}$ul.listview("refresh");});var conex=checkConnection();var $mprecision=$("#mprecision");var $mconex=$("#mconex");$mprecision.html('Lat:'+Lat1+'<br>Long:'+Long2+'<br>Precis:'+Precision);$mconex.html('Conec a: '+conex+'<br>');var $urba=$("#urba");$.getJSON('200.60.11.227:81/moviles3/busUrba.php?lat1='+Lat1+'&long2='+Long2,function(result){var data=result.results;for(var item in data){var urba=data[item].urba;content='Ubic : '+urba;$urba.html(content);}});alert('Listo te ubique ahi tienes la lista de usuarios cercanos a tu posicion');}}};function llenaLista(){var data1=JSON.parse(localStorage.getItem("lista"));for(var item in data1){var id=data1[item].id;var nomcli=data1[item].nomcli;var lat=data1[item].st_x;var long=data1[item].st_y;var vgral=data1[item].vgral;content='<li><a onclick="funca('+lat+','+long+','+Lat1+','+Long2+','+id+',\''+nomcli+'\',\''+vgral+'\');">'+id+'-'+nomcli+'</a></li>';$ul.append(content);}$ul.listview("refresh");}
